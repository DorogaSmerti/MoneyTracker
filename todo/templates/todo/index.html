<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ToDo API</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 20px auto;
        }
        .completed {
            text-decoration: line-through;
            color: gray;
        }
        button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>üìù –ú–æ–π ToDo —Å–ø–∏—Å–æ–∫</h1>

    <form id="task-form">
        <input type="text" id="task-title" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞..." required>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <button id="filter-button">–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</button>

    <ul id="task-list"></ul>

    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞ –∏–∑ cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');
        const apiUrl = 'todo_main';
        let showCompletedOnly = false;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
        function loadTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';

            let url = apiUrl;
            if (showCompletedOnly) {
                url += '?completed=true';
            }

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    data.forEach(task => {
                        const li = document.createElement('li');
                        li.className = task.completed ? 'completed' : '';
                        li.innerHTML = `
                            ${task.title}
                            <button onclick="toggleTask(${task.id})">‚úî</button>
                            <button onclick="deleteTask(${task.id})">‚ùå</button>
                        `;
                        list.appendChild(li);
                    });
                });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function addTask(e) {
            e.preventDefault();
            const title = document.getElementById('task-title').value;
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ title })
            }).then(() => {
                document.getElementById('task-title').value = '';
                loadTasks();
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        function deleteTask(id) {
            fetch(`delete/${id}`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': csrftoken
                }
            }).then(() => loadTasks());
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
        function toggleTask(id) {
            fetch(`change_status/${id}`, {
                method: 'PUT',
                headers: {
                    'X-CSRFToken': csrftoken
                }
            }).then(() => loadTasks());
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö
        document.getElementById('filter-button').addEventListener('click', function () {
            showCompletedOnly = !showCompletedOnly;
            this.textContent = showCompletedOnly ? '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ';
            loadTasks();
        });

        document.getElementById('task-form').addEventListener('submit', addTask);

        loadTasks();
    </script>
</body>
</html>